/*OMF CHARGEOFF*/
/*PULL BACK CHARGE OFF FIELDS FROM INDIVIDUAL TABLE*/
CREATE
or replace TABLE OMF_EXT_USER_SPACE.AJONES.INDIVIDUAL as
select
    INDIV_ID,
    EXP_CO_FLG,
    EQF_CO_FLG,
    CHARGE_OFF_YN,
    ILOAN_REASON_CD,
    TOT_CO_YN,
    CHARGE_OFF_YN_EVER
from
    PROD_OMF_INBOUND_DATA_SHARE.PROD_ANALYTIC_MART_SHARE.INDIVIDUAL
where
    indiv_id is not null;
    /*PULL BACK APPLICATION RECORS*/
    CREATE
    or replace TABLE OMF_EXT_USER_SPACE.AJONES.APPLICATION as
select
    INDIV_ID,
    APPL_KEY
from
    PROD_OMF_INBOUND_DATA_SHARE.PROD_ANALYTIC_MART_SHARE.APPLICATION
where
    indiv_id is not null;
    /*COMBINE TABLES*/
    CREATE
    or replace TABLE OMF_EXT_USER_SPACE.AJONES.INDIVIDUAL_APP as
select
    A.*,
    b.appl_key
from
    OMF_EXT_USER_SPACE.AJONES.INDIVIDUAL A
    inner join OMF_EXT_USER_SPACE.AJONES.APPLICATION B on a.INDIV_ID = b.indiv_id;
DROP TABLE OMF_EXT_USER_SPACE.AJONES.INDIVIDUAL;
DROP TABLE OMF_EXT_USER_SPACE.AJONES.APPLICATION;
    /*LIMIT TO CHARGE OFF RECORDS*/
    CREATE
    or replace TABLE OMF_EXT_USER_SPACE.AJONES.OMF_FILE_APP_CHARGEOFF AS
SELECT
    *,
    to_varchar (CURRENT_DATE(), 'YYYY_MM_DD') as MOD_DATE
FROM
    OMF_EXT_USER_SPACE.AJONES.INDIVIDUAL_APP
WHERE
    ILOAN_REASON_CD IN ('iLoan_Charge_Off', 'iLoan Charge-Off')
    OR EXP_CO_FLG = 'Y'
    OR EQF_CO_FLG = 'Y'
    OR CHARGE_OFF_YN_EVER = 'Y'
    OR TOT_CO_YN = 'Y'
    AND APPL_KEY <> 0
    OR APPL_KEY IS NOT NULL;
ALTER TABLE
    OMF_EXT_USER_SPACE.AJONES.OMF_FILE_APP_CHARGEOFF
ADD
    AUTH_CD varchar(50);
UPDATE
    OMF_EXT_USER_SPACE.AJONES.OMF_FILE_APP_CHARGEOFF
SET
    AUTH_CD = 'ONEMAIN_CO';
CREATE
    or replace TABLE OMF_EXT_USER_SPACE.AJONES.OMF_APP_FILE AS
SELECT
    APPL_KEY,
    AUTH_CD,
    MOD_DATE
FROM
    OMF_EXT_USER_SPACE.AJONES.OMF_FILE_APP_CHARGEOFF